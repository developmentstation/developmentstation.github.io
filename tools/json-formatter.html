<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Formatter & Validator - DevTools Hub</title>
    <meta name="description" content="Format, validate, and minify JSON data online. Free JSON formatter with syntax highlighting and error detection.">
    <meta name="keywords" content="json formatter, json validator, json minifier, json beautifier, json parser, format json">
    <meta name="author" content="DevTools Hub">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="JSON Formatter & Validator - DevTools Hub">
    <meta property="og:description" content="Format, validate, and minify JSON data online">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://devtools-hub.com/tools/json-formatter.html">
    <meta property="og:image" content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÑ</text></svg>">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="JSON Formatter & Validator - DevTools Hub">
    <meta name="twitter:description" content="Format, validate, and minify JSON data online">
    <meta name="twitter:image" content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÑ</text></svg>">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÑ</text></svg>">
    
    <!-- Theme -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="color-scheme" content="light dark">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../assets/css/modern-styles.css">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "JSON Formatter & Validator",
        "description": "Format, validate, and minify JSON data online",
        "url": "https://devtools-hub.com/tools/json-formatter.html",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "JSON formatting and beautification",
            "JSON validation with error detection",
            "JSON minification",
            "Syntax highlighting",
            "Error reporting with line numbers"
        ]
    }
    </script>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <button class="btn btn-ghost" onclick="goBack()" aria-label="Go back">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <a href="../index.html" class="logo">
                        <span class="logo-icon">üõ†Ô∏è</span>
                        <span>DevTools Hub</span>
                    </a>
                </div>
                
                <nav class="nav-links">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="../tools/data-tools.html" class="nav-link active">Data Tools</a>
                    <a href="../tools/text-tools.html" class="nav-link">Text Tools</a>
                    <a href="../tools/security-tools.html" class="nav-link">Security</a>
                </nav>
                
                <div class="header-actions">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="Search tools..." class="search-input">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                    </div>
                    
                    <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
                        <span id="themeIcon">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                <!-- Breadcrumb will be populated by JavaScript -->
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <div class="tool-layout">
                <!-- Main Tool Content -->
                <div class="tool-content">
                    <!-- Tool Header -->
                    <div class="tool-header">
                        <div class="tool-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                        </div>
                        <div class="tool-info">
                            <h1>JSON Formatter & Validator</h1>
                            <p class="tool-description">Format, validate, and minify JSON data with syntax highlighting and comprehensive error reporting.</p>
                        </div>
                    </div>

                    <!-- JSON Input Section -->
                    <div class="card mb-6">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">JSON Input</h3>
                                <p class="card-description">Paste your JSON data here</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="jsonInput" class="form-label">JSON Data</label>
                            <textarea 
                                id="jsonInput" 
                                placeholder='{"name": "John", "age": 30, "city": "New York"}' 
                                class="form-textarea font-mono" 
                                rows="12"
                                oninput="validateJSON()"
                            ></textarea>
                        </div>

                        <div class="btn-group">
                            <button onclick="formatJSON()" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                Format JSON
                            </button>
                            <button onclick="minifyJSON()" class="btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                                Minify JSON
                            </button>
                            <button onclick="validateOnlyJSON()" class="btn btn-outline">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Validate Only
                            </button>
                            <button onclick="clearJSON()" class="btn btn-ghost">Clear</button>
                        </div>

                        <!-- JSON Validation Status -->
                        <div id="jsonStatus" class="mt-4"></div>
                    </div>

                    <!-- JSON Output Section -->
                    <div class="card mb-6">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 11 12 14 22 4"/>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">Formatted JSON</h3>
                                <p class="card-description">Formatted and validated output</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="jsonOutput" class="form-label">Output</label>
                            <div class="result-area">
                                <textarea 
                                    id="jsonOutput" 
                                    placeholder="Formatted JSON will appear here..." 
                                    class="form-textarea font-mono" 
                                    rows="12"
                                    readonly
                                ></textarea>
                                <button class="copy-btn" data-target="jsonOutput">Copy</button>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button onclick="downloadJSON()" class="btn btn-outline">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download JSON
                            </button>
                        </div>
                    </div>

                    <!-- JSON Tree View -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">JSON Tree View</h3>
                                <p class="card-description">Interactive tree representation</p>
                            </div>
                        </div>
                        
                        <div class="form-group" style="padding:1rem; border-top:1px solid var(--border-primary);">
                            <label class="form-label">Selected Path</label>
                            <div class="result-area">
                                <code id="selectedPath" class="result-content"></code>
                                <button class="copy-btn" data-target="selectedPath">Copy</button>
                            </div>
                        </div>

                        <div class="form-group" style="padding:0 1rem 1rem;">
                            <label class="form-label">Edit Selected Value</label>
                            <input id="selectedValueEdit" class="form-input" placeholder='Enter JSON literal, e.g. "text", 123, true, null, {"a":1}'>
                            <div class="btn-group" style="margin-top:.5rem"><button class="btn" onclick="updateSelectedValue()">Update Value</button></div>
                        </div>

                        <div id="jsonTree" class="json-tree-container">
                            <div class="text-center text-secondary p-8">
                                Enter valid JSON above to see the tree view
                            </div>
                        </div>
                    </div>
        
            <!-- JSONPath Finder -->
            <div class="card mt-6">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="card-title">JSONPath Finder</h3>
                        <p class="card-description">Query JSON using simple JSONPath (supports $, dot/bracket, indexes, and *)</p>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="jsonPathExpr">Expression</label>
                        <input id="jsonPathExpr" class="form-input" placeholder="e.g., $.store.book[0].title or $.store.*">
                        <div class="text-xs text-secondary" style="margin-top:.25rem;">Supported: $ root, .key, ['key'], [index], [*], and wildcard .* on objects/arrays.</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Actions</label>
                        <div class="btn-group" style="margin-top:0;">
                            <button class="btn btn-primary" onclick="runJsonPath()">Find</button>
                            <button class="btn btn-outline" onclick="clearJsonPath()">Clear</button>
                        </div>
                    </div>
                </div>

                <div id="jsonPathResult" class="result-area" style="display:none;">
                    <div class="result-content" id="jsonPathOutput"></div>
                    <button class="copy-btn" data-target="jsonPathOutput">Copy</button>
                </div>
            </div>
                </div>

                <!-- Sidebar -->
                <div class="tool-sidebar">
                    <!-- JSON Statistics -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">JSON Statistics</h3>
                            </div>
                        </div>
                        <div id="jsonStats" class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Size:</span>
                                <span id="jsonSize">0 bytes</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Lines:</span>
                                <span id="jsonLines">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Objects:</span>
                                <span id="jsonObjects">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Arrays:</span>
                                <span id="jsonArrays">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Properties:</span>
                                <span id="jsonProperties">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- JSON Examples -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4m6-6h4a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-4m-6 0V9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-2"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">Quick Examples</h3>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <button onclick="loadExample('simple')" class="block w-full text-left p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">Simple Object</div>
                                <div class="text-xs text-secondary">Basic key-value pairs</div>
                            </button>
                            <button onclick="loadExample('array')" class="block w-full text-left p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">Array Example</div>
                                <div class="text-xs text-secondary">Array with mixed types</div>
                            </button>
                            <button onclick="loadExample('nested')" class="block w-full text-left p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">Nested Object</div>
                                <div class="text-xs text-secondary">Complex nested structure</div>
                            </button>
                            <button onclick="loadExample('api')" class="block w-full text-left p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">API Response</div>
                                <div class="text-xs text-secondary">Typical REST API response</div>
                            </button>
                        </div>
                    </div>

                    <!-- Related Tools -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="card-title">Related Tools</h3>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <a href="xml-formatter.html" class="block p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">XML Formatter</div>
                                <div class="text-xs text-secondary">Format and validate XML</div>
                            </a>
                            <a href="yaml-converter.html" class="block p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">YAML Converter</div>
                                <div class="text-xs text-secondary">Convert JSON ‚Üî YAML</div>
                            </a>
                            <a href="csv-converter.html" class="block p-3 rounded-lg hover:bg-secondary transition-colors">
                                <div class="font-medium text-sm">CSV Converter</div>
                                <div class="text-xs text-secondary">Convert JSON ‚Üî CSV</div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>DevTools Hub</h4>
                    <p>Professional developer tools that work offline. Privacy-focused and completely free.</p>
                </div>
                <div class="footer-section">
                    <h4>Data Tools</h4>
                    <a href="json-formatter.html">JSON Formatter</a>
                    <a href="xml-formatter.html">XML Formatter</a>
                    <a href="yaml-converter.html">YAML Converter</a>
                    <a href="csv-converter.html">CSV Converter</a>
                </div>
                <div class="footer-section">
                    <h4>Popular Tools</h4>
                    <a href="base64-encoder.html">Base64 Encoder</a>
                    <a href="qr-code-generator.html">QR Code Generator</a>
                    <a href="password-generator.html">Password Generator</a>
                    <a href="unix-timestamp-converter.html">Unix Timestamp</a>
                </div>
                <div class="footer-section">
                    <h4>Features</h4>
                    <span>‚úì Works Offline</span>
                    <span>‚úì No Data Collection</span>
                    <span>‚úì Open Source</span>
                    <span>‚úì Mobile Friendly</span>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 DevTools Hub. Built with ‚ù§Ô∏è for developers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../assets/js/modern-shared.js"></script>
    <script>
        // JSON Examples
        const jsonExamples = {
            simple: {
                "name": "John Doe",
                "age": 30,
                "email": "john@example.com",
                "active": true
            },
            array: [
                "apple",
                "banana",
                "cherry",
                { "name": "orange", "color": "orange" },
                42,
                true
            ],
            nested: {
                "user": {
                    "id": 1,
                    "profile": {
                        "name": "Jane Smith",
                        "contact": {
                            "email": "jane@example.com",
                            "phone": "+1-555-0123"
                        },
                        "preferences": {
                            "theme": "dark",
                            "notifications": true
                        }
                    }
                },
                "posts": [
                    {
                        "id": 101,
                        "title": "Hello World",
                        "tags": ["intro", "programming"]
                    },
                    {
                        "id": 102,
                        "title": "JSON Tutorial",
                        "tags": ["json", "tutorial", "web"]
                    }
                ]
            },
            api: {
                "status": "success",
                "data": {
                    "users": [
                        {
                            "id": 1,
                            "username": "alice",
                            "created_at": "2024-01-15T10:30:00Z"
                        },
                        {
                            "id": 2,
                            "username": "bob",
                            "created_at": "2024-01-16T14:22:00Z"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "per_page": 10,
                        "total": 2
                    }
                },
                "message": "Users retrieved successfully"
            }
        };

        // JSON Formatter Functions
        function formatJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                ToastManager.error('Please enter JSON data to format');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                const formatted = JSON.stringify(parsed, null, 2);
                document.getElementById('jsonOutput').value = formatted;
                updateJSONStats(parsed, formatted);
                generateJSONTree(parsed);
                showValidationStatus(true, 'JSON is valid and formatted successfully');
                ToastManager.success('JSON formatted successfully');
            } catch (error) {
                showValidationStatus(false, error.message);
                ToastManager.error('Invalid JSON: ' + error.message);
            }
        }

        function minifyJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                ToastManager.error('Please enter JSON data to minify');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                const minified = JSON.stringify(parsed);
                document.getElementById('jsonOutput').value = minified;
                updateJSONStats(parsed, minified);
                generateJSONTree(parsed);
                showValidationStatus(true, 'JSON is valid and minified successfully');
                ToastManager.success('JSON minified successfully');
            } catch (error) {
                showValidationStatus(false, error.message);
                ToastManager.error('Invalid JSON: ' + error.message);
            }
        }

        function validateOnlyJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                ToastManager.error('Please enter JSON data to validate');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                updateJSONStats(parsed, input);
                generateJSONTree(parsed);
                showValidationStatus(true, 'JSON is valid');
                ToastManager.success('JSON is valid');
            } catch (error) {
                showValidationStatus(false, error.message);
                updateJSONStats(null, input);
                ToastManager.error('Invalid JSON: ' + error.message);
            }
        }

        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                clearValidationStatus();
                updateJSONStats(null, '');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                updateJSONStats(parsed, input);
                generateJSONTree(parsed);
                showValidationStatus(true, 'JSON is valid');
            } catch (error) {
                showValidationStatus(false, error.message);
                updateJSONStats(null, input);
                clearJSONTree();
            }
        }

        function clearJSON() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('jsonOutput').value = '';
            clearValidationStatus();
            updateJSONStats(null, '');
            clearJSONTree();
        }

        function downloadJSON() {
            const output = document.getElementById('jsonOutput').value;
            if (!output) {
                ToastManager.error('No JSON to download');
                return;
            }

            FileManager.downloadText(output, 'formatted.json', 'application/json');
        }

        function loadExample(type) {
            const example = jsonExamples[type];
            if (example) {
                const jsonString = JSON.stringify(example, null, 2);
                document.getElementById('jsonInput').value = jsonString;
                validateJSON();
                ToastManager.success(`Loaded ${type} example`);
            }
        }

        // Helper Functions
        function showValidationStatus(isValid, message) {
            const statusDiv = document.getElementById('jsonStatus');
            statusDiv.innerHTML = `
                <div class="flex items-center gap-3 p-4 rounded-lg ${isValid ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'}">
                    <div class="flex-shrink-0">
                        ${isValid 
                            ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
                            : '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
                        }
                    </div>
                    <div class="flex-1">
                        <div class="font-medium">${isValid ? 'Valid JSON' : 'Invalid JSON'}</div>
                        <div class="text-sm mt-1">${message}</div>
                    </div>
                </div>
            `;
        }

        function clearValidationStatus() {
            document.getElementById('jsonStatus').innerHTML = '';
        }

        function updateJSONStats(parsed, jsonString) {
            const size = new Blob([jsonString]).size;
            const lines = jsonString.split('\n').length;
            
            let objects = 0;
            let arrays = 0;
            let properties = 0;

            if (parsed) {
                const stats = analyzeJSON(parsed);
                objects = stats.objects;
                arrays = stats.arrays;
                properties = stats.properties;
            }

            document.getElementById('jsonSize').textContent = formatFileSize(size);
            document.getElementById('jsonLines').textContent = lines;
            document.getElementById('jsonObjects').textContent = objects;
            document.getElementById('jsonArrays').textContent = arrays;
            document.getElementById('jsonProperties').textContent = properties;
        }

        function analyzeJSON(obj, stats = { objects: 0, arrays: 0, properties: 0 }) {
            if (typeof obj === 'object' && obj !== null) {
                if (Array.isArray(obj)) {
                    stats.arrays++;
                    obj.forEach(item => analyzeJSON(item, stats));
                } else {
                    stats.objects++;
                    Object.keys(obj).forEach(key => {
                        stats.properties++;
                        analyzeJSON(obj[key], stats);
                    });
                }
            }
            return stats;
        }

        let __jsonCurrent = null;
        let __jsonSelectedPath = '';

        function generateJSONTree(obj) {
            const treeContainer = document.getElementById('jsonTree');
            treeContainer.innerHTML = '';
            __jsonCurrent = obj;
            const tree = createTreeElement(obj, null, 0, '');
            treeContainer.appendChild(tree);
        }

        function clearJSONTree() {
            document.getElementById('jsonTree').innerHTML = `
                <div class="text-center text-secondary p-8">
                    Enter valid JSON above to see the tree view
                </div>
            `;
        }

        function createTreeElement(obj, key = null, level = 0, parentPath = '') {
            const container = document.createElement('div');
            container.className = 'json-tree-item';
            container.style.marginLeft = `${level * 20}px`;

            if (typeof obj === 'object' && obj !== null) {
                if (Array.isArray(obj)) {
                    const header = document.createElement('div');
                    header.className = 'json-tree-header';
                    const path = composeChildPath(parentPath, key);
                    header.dataset.path = path;
                    header.innerHTML = `
                        <span class="json-tree-toggle" aria-label="toggle">‚ñ∏</span>
                        <span class="json-tree-key">${key !== null ? `"${key}": ` : ''}[</span>
                        <span class="json-tree-type">Array(${obj.length})</span>
                    `;
                    container.appendChild(header);
                    header.addEventListener('click', (e)=>{ onHeaderClick(e, header, obj); });

                    const children = document.createElement('div');
                    children.className = 'json-tree-children';
                    obj.forEach((item, index) => {
                        const child = createTreeElement(item, index, level + 1, path);
                        children.appendChild(child);
                    });
                    container.appendChild(children);

                    const footer = document.createElement('div');
                    footer.className = 'json-tree-footer';
                    footer.style.marginLeft = `${level * 20}px`;
                    footer.textContent = ']';
                    container.appendChild(footer);
                } else {
                    const header = document.createElement('div');
                    header.className = 'json-tree-header';
                    const path = composeChildPath(parentPath, key);
                    header.dataset.path = path;
                    header.innerHTML = `
                        <span class="json-tree-toggle" aria-label="toggle">‚ñ∏</span>
                        <span class="json-tree-key">${key !== null ? `"${key}": ` : ''}{</span>
                        <span class="json-tree-type">Object</span>
                    `;
                    container.appendChild(header);
                    header.addEventListener('click', (e)=>{ onHeaderClick(e, header, obj); });

                    const children = document.createElement('div');
                    children.className = 'json-tree-children';
                    Object.entries(obj).forEach(([k, v]) => {
                        const child = createTreeElement(v, k, level + 1, path);
                        children.appendChild(child);
                    });
                    container.appendChild(children);

                    const footer = document.createElement('div');
                    footer.className = 'json-tree-footer';
                    footer.style.marginLeft = `${level * 20}px`;
                    footer.textContent = '}';
                    container.appendChild(footer);
                }
            } else {
                const leaf = document.createElement('div');
                leaf.className = 'json-tree-leaf';
                const path = composeChildPath(parentPath, key);
                const valueClass = typeof obj === 'string' ? 'json-string' :
                                 typeof obj === 'number' ? 'json-number' :
                                 typeof obj === 'boolean' ? 'json-boolean' :
                                 obj === null ? 'json-null' : '';
                
                const displayValue = typeof obj === 'string' ? `"${obj}"` : String(obj);
                leaf.innerHTML = `
                    <span class="json-tree-key">${key !== null ? `"${key}": ` : ''}</span>
                    <span class="json-tree-value ${valueClass}">${displayValue}</span>
                `;
                leaf.dataset.path = path;
                leaf.addEventListener('click', ()=> selectPath(path, obj, leaf));
                container.appendChild(leaf);
            }

            return container;
        }

        function onHeaderClick(e, header, obj) {
            const children = header.parentElement.querySelector(':scope > .json-tree-children');
            if (children) {
                const collapsed = children.style.display === 'none';
                children.style.display = collapsed ? '' : 'none';
                const caret = header.querySelector('.json-tree-toggle');
                if (caret) caret.textContent = collapsed ? '‚ñæ' : '‚ñ∏';
            }
            const path = header.dataset.path || '';
            selectPath(path, obj, header);
        }

        function selectPath(path, value, el) {
            __jsonSelectedPath = path;
            const sp = document.getElementById('selectedPath');
            sp.textContent = path;
            const ve = document.getElementById('selectedValueEdit');
            try { ve.value = JSON.stringify(value); } catch { ve.value = String(value); }
            document.querySelectorAll('.json-selected').forEach(n=> n.classList.remove('json-selected'));
            el.classList.add('json-selected');
        }

        function composeChildPath(parent, key) {
            if (parent === '') return key === null ? '' : (isIdentifier(String(key)) ? String(key) : `["${String(key)}"]`);
            if (key === null) return parent;
            if (typeof key === 'number') return parent + `[${key}]`;
            const k = String(key);
            return parent + (isIdentifier(k) ? `.${k}` : `["${k}"]`);
        }

        function isIdentifier(k) {
            return /^[A-Za-z_][A-Za-z0-9_-]*$/.test(k);
        }

        function updateSelectedValue() {
            if (!__jsonSelectedPath) { if (window.ToastManager) window.ToastManager.info('Select a node in the tree'); return; }
            if (!__jsonCurrent) { if (window.ToastManager) window.ToastManager.info('No JSON loaded'); return; }
            const raw = document.getElementById('selectedValueEdit').value;
            let newVal;
            try { newVal = JSON.parse(raw); }
            catch { if (window.ToastManager) window.ToastManager.error('Enter a valid JSON literal'); return; }
            try {
                setByPath(__jsonCurrent, __jsonSelectedPath, newVal);
                const pretty = JSON.stringify(__jsonCurrent, null, 2);
                document.getElementById('jsonInput').value = pretty;
                document.getElementById('jsonOutput').value = pretty;
                updateJSONStats(__jsonCurrent, pretty);
                generateJSONTree(__jsonCurrent);
                if (window.ToastManager) window.ToastManager.success('Value updated');
            } catch (e) {
                if (window.ToastManager) window.ToastManager.error('Failed to update: ' + (e && e.message ? e.message : e));
            }
        }

        function setByPath(root, path, value) {
            const tokens = [];
            let i = 0;
            while (i < path.length) {
                const ch = path[i];
                if (ch === '.') { i++; continue; }
                if (ch === '[') {
                    i++;
                    if (path[i] === '"' || path[i] === "'") {
                        const q = path[i++];
                        let key = '';
                        while (i < path.length && path[i] !== q) key += path[i++];
                        if (path[i] !== q) throw new Error('Unclosed quote');
                        i++; if (path[i] !== ']') throw new Error('Expected ]'); i++;
                        tokens.push(key);
                        continue;
                    } else {
                        let num = '';
                        while (i < path.length && /[0-9]/.test(path[i])) num += path[i++];
                        if (path[i] !== ']') throw new Error('Expected ]'); i++;
                        tokens.push(parseInt(num,10));
                        continue;
                    }
                }
                let id = '';
                while (i < path.length && /[A-Za-z0-9_-]/.test(path[i])) id += path[i++];
                if (id) { tokens.push(id); continue; }
                i++;
            }
            if (!tokens.length) throw new Error('Invalid path');
            let obj = root;
            for (let t = 0; t < tokens.length - 1; t++) {
                const k = tokens[t];
                if (obj == null) throw new Error('Path does not exist');
                obj = obj[k];
            }
            const last = tokens[tokens.length - 1];
            if (obj == null || (typeof obj !== 'object')) throw new Error('Parent is not an object/array');
            obj[last] = value;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load a simple example by default
            loadExample('simple');
        });

        // -------------------------
        // JSONPath Finder (minimal)
        // -------------------------
        function runJsonPath() {
            const expr = (document.getElementById('jsonPathExpr').value || '').trim();
            if (!expr) {
                if (window.ToastManager) window.ToastManager.info('Enter a JSONPath expression');
                return;
            }
            const raw = document.getElementById('jsonInput').value.trim();
            if (!raw) {
                if (window.ToastManager) window.ToastManager.info('Enter JSON in the input area');
                return;
            }
            let obj;
            try { obj = JSON.parse(raw); }
            catch (e) { if (window.ToastManager) window.ToastManager.error('Invalid JSON input'); return; }

            try {
                const matches = evalJsonPath(obj, expr);
                const lines = matches.map(m => `${m.path}: ${safeStringify(m.value)}`);
                const out = lines.length ? lines.join('\n') : 'No match';
                document.getElementById('jsonPathOutput').textContent = out;
                document.getElementById('jsonPathResult').style.display = 'block';
            } catch (e) {
                document.getElementById('jsonPathOutput').textContent = 'Error: ' + (e && e.message ? e.message : 'Invalid expression');
                document.getElementById('jsonPathResult').style.display = 'block';
            }
        }

        function clearJsonPath() {
            document.getElementById('jsonPathExpr').value = '';
            document.getElementById('jsonPathOutput').textContent = '';
            document.getElementById('jsonPathResult').style.display = 'none';
        }

        function safeStringify(v) {
            try { return JSON.stringify(v); } catch { return String(v); }
        }

        function evalJsonPath(root, expr) {
            // Supported grammar: $ optional root; dot segments .key; bracket ['key'] or [index]; wildcard * and [*]
            const s = expr.replace(/\s+/g, '');
            let pos = 0;
            if (s[pos] === '$') pos++;
            const segments = [];

            while (pos < s.length) {
                const ch = s[pos];
                if (ch === '.') {
                    pos++;
                    if (s[pos] === '*') { segments.push({ t: 'wild' }); pos++; continue; }
                    const id = readIdentifier(s, pos);
                    if (!id.name) throw new Error('Expected identifier after dot');
                    segments.push({ t: 'key', k: id.name });
                    pos = id.next;
                    continue;
                }
                if (ch === '[') {
                    // [*] or [index] or ['key'] or ["key"]
                    pos++;
                    if (s[pos] === '*') { segments.push({ t: 'wild' }); pos++; expect(']'); continue; }
                    if (s[pos] === '"' || s[pos] === "'") {
                        const q = s[pos]; pos++;
                        let key = '';
                        while (pos < s.length && s[pos] !== q) { key += s[pos++]; }
                        expect(q);
                        expect(']');
                        segments.push({ t: 'key', k: key });
                        continue;
                    }
                    // number
                    const num = readNumber(s, pos);
                    if (num.value == null) throw new Error('Expected index inside brackets');
                    segments.push({ t: 'idx', i: num.value });
                    pos = num.next; expect(']');
                    continue;
                }
                // bare identifier at start
                const id = readIdentifier(s, pos);
                if (id.name) { segments.push({ t: 'key', k: id.name }); pos = id.next; continue; }
                throw new Error('Unexpected token at position ' + pos);
            }

            // Walk segments
            let nodes = [{ path: '$', value: root }];
            for (const seg of segments) {
                nodes = step(nodes, seg);
            }
            return nodes.filter(n => n.path !== '$');

            function expect(c) { if (s[pos] !== c) throw new Error(`Expected '${c}' at ${pos}`); pos++; }
            function readIdentifier(str, p) {
                const m = /^[A-Za-z_][A-Za-z0-9_-]*/.exec(str.slice(p));
                if (!m) return { name: '', next: p };
                return { name: m[0], next: p + m[0].length };
            }
            function readNumber(str, p) {
                const m = /^\d+/.exec(str.slice(p));
                if (!m) return { value: null, next: p };
                return { value: parseInt(m[0], 10), next: p + m[0].length };
            }
            function step(prevNodes, seg) {
                const out = [];
                for (const n of prevNodes) {
                    const v = n.value;
                    if (seg.t === 'key') {
                        if (v && typeof v === 'object' && Object.prototype.hasOwnProperty.call(v, seg.k)) {
                            const nextPath = n.path + (isIdentifier(seg.k) ? '.' + seg.k : `["${seg.k}"]`);
                            out.push({ path: nextPath, value: v[seg.k] });
                        }
                    } else if (seg.t === 'idx') {
                        if (Array.isArray(v) && seg.i >= 0 && seg.i < v.length) {
                            out.push({ path: n.path + `[${seg.i}]`, value: v[seg.i] });
                        }
                    } else if (seg.t === 'wild') {
                        if (Array.isArray(v)) {
                            for (let i = 0; i < v.length; i++) out.push({ path: n.path + `[${i}]`, value: v[i] });
                        } else if (v && typeof v === 'object') {
                            for (const k of Object.keys(v)) {
                                const nextPath = n.path + (isIdentifier(k) ? '.' + k : `["${k}"]`);
                                out.push({ path: nextPath, value: v[k] });
                            }
                        }
                    }
                }
                return out;
            }
            function isIdentifier(k) { return /^[A-Za-z_][A-Za-z0-9_-]*$/.test(k); }
        }
    </script>

    <style>
        /* JSON Tree Styles */
        .json-tree-container {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-4);
            font-family: var(--font-family-mono);
            font-size: var(--text-sm);
            max-height: 400px;
            overflow-y: auto;
        }

        .json-tree-item {
            margin-bottom: var(--spacing-1);
        }

        .json-tree-header,
        .json-tree-leaf {
            padding: var(--spacing-1) 0;
            cursor: pointer;
        }

        .json-tree-key {
            color: var(--color-primary);
            font-weight: var(--font-medium);
        }

        .json-tree-type {
            color: var(--text-tertiary);
            font-size: var(--text-xs);
            margin-left: var(--spacing-2);
        }

        .json-string {
            color: var(--color-success);
        }

        .json-number {
            color: var(--color-warning);
        }

        .json-boolean {
            color: var(--color-info);
        }

        .json-null {
            color: var(--text-tertiary);
            font-style: italic;
        }

        .json-tree-footer {
            color: var(--text-secondary);
        }

        .json-selected {
            background: var(--bg-card);
            border-radius: var(--radius-md);
        }

        .json-tree-toggle {
            display: inline-block;
            width: 1em;
            color: var(--text-secondary);
            margin-right: .25rem;
        }

        .json-tree-children { margin-left: 0; }
    </style>
</body>
</html>
